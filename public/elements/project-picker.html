<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">

<dom-module id="project-picker">
  <template>
    <style>
      [slot="dropdown-content"] {
        background-color: white;
        line-height: 40px;
        padding: 0 10px 0 10px;
        box-shadow: 0px 2px 6px #ccc;
        list-style: none;
      }
    </style>
    <firebase-auth user="{{user}}"></firebase-auth> 
    <firebase-query
      id="projectQuery"
      path="/users/[[user.uid]]/projects"
      data="{{projects}}">
    </firebase-query>

    <iron-dropdown id="dropdown">
        <div slot="dropdown-content"> 
          <iron-selector id="selector" selected="{{selectedProject}}" attr-for-selected="val">
        <template is="dom-repeat" items="[[projects]]" as="project">
          <div val$="[[project]]" >[[project.name]]</div>
        </template>
      </iron-selector>
        </div>
    </iron-dropdown>
  </template>

  <script>
    class ProjectPicker extends Polymer.Element {
      static get is() { return 'project-picker'; }

      static get properties() {
        return {
          selectedProject: {
            type: Object,
            observer: '_changeProject'
          }
        }
      }

      toggle() {
        this.$.dropdown.toggle();
      }

      _changeProject(newVal, oldVal) {
        this.dispatchEvent(new CustomEvent('project-selected',
          {detail: {project: newVal}}));
        
        this.toggle();
      }

    }

    window.customElements.define(ProjectPicker.is, ProjectPicker);
  </script>
</dom-module>
